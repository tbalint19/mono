# OPENID PROVIDER

An openID provider is required for the project to work - it does need to be self-hosted though, feel free to use anything else (google, for example). All we need is an openID provider, where we can register an app with a **redirect_uri** to get a **client_id** and a **client_secret**.

If you want a self-hosted provider (recommended):

## Create .env file

- Copy .env.template -> .env
- DONE (default values can stay as is)

## Start provider with database

```bash
# monorepo/executables/oauth
docker-compose up -d

# check logs - optional
 docker-compose logs -f
```

## Database admin tool (skipped)

You can technically add a database admin tool, just copy pgadmin section from _executables/database/docker-compose.yml_ and follow _executables/database/README.md_ - note, that it should be mapped to a different port (**8081**, for example), if _that_ pgadmin is also running. Even in this case, the two can not run in the same browser, one must be opened in an incognito window, to avoid csrf token collision issues. It is not necessary by any means though - these tables will be CRUD-ed by the built-in fuisonauth admin app. **See next step.**

## Register an app in fusionauth

- Open fusionauth in your broser
  - Go to [localhost:9011](http://localhost:9011)
- Create an admin user
  - An initial "wizard" page should appear
  - Local instance, so email address can be any dummy email address
  - If for any reason you have given your own email address (why?) you should uncheck marketing emails
  - You should use `admin@email.com` /// `password` - it is here in the document, you won't forget it
- Create an application
  - Left sidebar -> Applications
  - Top right corner -> green plus icon button
  - **Id** will be autogenerated if empty, **Name** can be anything
  - Top right corner -> blue save icon button
- Set up openID
  - Action dropdown - Edit
  - OAuth tab (default)
  - **Client id** is already generated
  - **Client secret** is already generated
  - Set **Authorized redirect URLs** - http://localhost:5371/login
  - Set **Require registration** to true (optional, recommended)
  - Top right corner -> blue save icon button
- Set up registration page
  - (optional, recommended - otherwise only users that are added through this admin app can enter)
  - Action dropdown - Edit
  - Registration tab
  - Set **Self-service registration** to **enabled**
  - Keep everything else unchanged ("keep it simple")
  - Top right corner -> blue save icon button

## Manage connected applications

- Later on you _may_ add other **redirect_uri**s, or even  other **application**s

## Stop provider (if no longer needed)

```bash
# monorepo/executables/oauth
docker-compose down

# or reset the whole project
 docker-compose down -v
```